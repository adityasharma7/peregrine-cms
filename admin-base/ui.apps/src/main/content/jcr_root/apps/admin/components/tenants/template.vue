<!--
  #%L
  admin base - UI Apps
  %%
  Copyright (C) 2017 headwire inc.
  %%
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.
  #L%
  -->
<template>

    <div>
        <fieldset class="vue-form-generator">
            <div class="form-group required">
                <div class="row">
                    <div class="col s6">
                        <label>Select Tenant</label>
                        <ul class="collection">
                            <li class="collection-item" v-for="child in children" v-bind:key="child.name">
                                <admin-components-action
                                    v-bind:model="{
                                        target: '/content/admin/pages/pages',
                                        command: 'selectPath',
                                        dblClickTarget: child,
                                        dblClickCommand: 'selectPath',
                                        tooltipTitle: `${$i18n('edit')} '${child.title || child.name}'`
                                    }">{{child.title ? child.title : child.name}}
                                </admin-components-action>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>

</template>

<script>
    import {set} from '../../../../../../js/utils';

    export default {
        props: ['model'],
        data(){
            return {
                isDraggingFile: false,
                isDraggingUiEl: false,
                isFileUploadVisible: false,
                uploadProgress: 0
            }
        },
        computed: {
            // showNavigateToParent() {
            //     return this.path.split('/').length > 4
            // },
            // path: function() {
            //     var dataFrom = this.model.dataFrom
            //     var node = $perAdminApp.getNodeFrom($perAdminApp.getView(), dataFrom)
            //     return node
            // },
            // pt: function() {
            //     var node = this.path
            //     return $perAdminApp.findNodeFromPath(this.$root.$data.admin.nodes, node)
            // },

            children: function() {
                return $perAdminApp.getNodeFrom($perAdminApp.getView(), '/admin/tenants')
            }
            // children: function() {
            //     if ( this.pt.children ) {
            //         return this.pt.children.filter( child => this.checkIfAllowed(child.resourceType) )
            //     }
            // },
            // parentPath: function() {
            //     var segments = this.$data.path.value.toString().split('/')
            //     var joined = segments.slice(0, segments.length -1).join('/')
            //     return joined
            // },
            // pathSegments: function() {
            //     var segments = this.path.toString().split('/')
            //     var ret = []
            //     for(var i = 1; i < segments.length; i++) {
            //         ret.push( { name: segments[i], path: segments.slice(0, i+1).join('/') } )
            //     }
            //     return ret;
            // },
            // hasEdit: function() {
            //     return this.model.children && this.model.children[0]
            // }
        },
        created() {
            // this.$root.$on('tenants-update', (data) => {
            //     const pathArr = this.path.split('/')
            //     pathArr[2] = data.current.name
            //     set($perAdminApp.getView(), this.model.dataFrom, pathArr.join('/'))
            //     this.selectPath(this, {
            //         path: pathArr.join('/')
            //     });
            // })
        },
        methods: {
//             getTenant() {
//               return $peAdminApp.getView().state.tenant || {name: 'example'}
//             },
//             isAssets(path){
//                 return path.startsWith(`/content/${this.getTenant().name}/assets`)
//             },
//             isSites(path){
//                 return path.startsWith(`/content/${this.getTenant().name}/sites`)
//             },
//             isObjects(path){
//                 return path.startsWith(`/content/${this.getTenant().name}/objects`)
//             },
//             isTemplates(path){
//                 return path.startsWith(`/content/${this.getTenant().name}/templates`)
//             },
//             selectParent(me, target) {
//                 var dataFrom = !me ? this.model.dataFrom : me.model.dataFrom
//                 var path = $perAdminApp.getNodeFrom($perAdminApp.getView(), dataFrom)
//                 var pathSegments = path.split('/')
//                 pathSegments.pop()
//                 path = pathSegments.join('/')
//                 $perAdminApp.action(!me ? this: me, 'selectPath', { path: path, resourceType: 'sling:OrderedFolder'})
//             },
//             selectItem(item) {
//                 $perAdminApp.action(this, 'selectPath', item)
//             },

//             replicatedClass(item) {
//                 if(item.ReplicationStatus) {
//                     const created = item.created
//                     const modified = item.lastModified ? item.lastModified : created
//                     const replicated = item.Replicated
//                     if(replicated > modified) {
//                         return 'item-'+item.ReplicationStatus
//                     } else {
//                         return 'item-'+item.ReplicationStatus+'-modified'
//                     }
//                 }
//                 return 'item-replication-unknown'
//             },
//             replicate(me, path) {
//                 $perAdminApp.stateAction('replicate', path)
//             },
//             replicatable(item) {
//                 return true
//             },
//             /* row drag events */
//             onDragRowStart(item, ev){
//                 ev.srcElement.classList.add("dragging");
//                 ev.dataTransfer.setData('text', item.path)
//                 if(this.isDraggingFile){ this.isDraggingFile = false }
//                 this.isDraggingUiEl = true
//             },

//             onDragRow(ev){
//                 ev.srcElement.classList.remove("dragging");
//             },

//             onDragRowEnd(item, ev){
//                 this.isDraggingUiEl = false
//             },

//             /* row drop zone events */
//             onDragOverRow(ev){
//                 if(this.isDraggingUiEl){
//                     const center = ev.target.offsetHeight / 2 ;
//                     this.dropType = ev.offsetY > center ? 'after' : 'before';
//                     ev.target.classList.toggle('drop-after', ev.offsetY > center );
//                     ev.target.classList.toggle('drop-before', ev.offsetY < center );
//                 }
//             },

//             onDragEnterRow(ev){
//             },

//             onDragLeaveRow(ev){
//                 if(this.isDraggingUiEl){
//                     ev.target.classList.remove('drop-after','drop-before')
//                 }
//             },

//             onDropRow(item, ev, type) {
//                 if(this.isDraggingUiEl){
//                     ev.target.classList.remove('drop-after','drop-before')
//                     /* reorder row logic */
//                     const dataFrom = this.model.dataFrom
//                     const path = $perAdminApp.getNodeFrom($perAdminApp.getView(), dataFrom)
//                     let action
//                     switch(true) {
//                         case (this.isSites(path)):
//                             action = 'movePage'
//                             break
//                         case (this.isTemplates(path)):
//                             action = 'moveTemplate'
//                             break
//                         case (this.isObjects(path)):
//                             action = 'moveObject'
//                             break
//                         case (this.isAssets(path)):
//                             action = 'moveAsset'
//                             break
//                         default:
//                             console.warn('path is not a site, asset, template or object.')
//                     }

//                     $perAdminApp.stateAction(action, {
//                         path: ev.dataTransfer.getData("text"),
//                         to: item.path,
//                         type: this.dropType
//                     })
//                 }
//             },

//             /* file drop zone events */
//             onDragOverExplorer(ev){

//             },

//             onDragEnterExplorer(ev){
//                 if(!this.isAssets(this.path)) return
//                 if(this.isDraggingUiEl) return
//                 this.isDraggingFile = true
//                 this.isFileUploadVisible = true
//             },

//             onDragLeaveExplorer(ev){
//                 /* hide upload overlay */
//                 /* TODO: fix upload unexpectedly closing
//                 if(this.isDraggingFile){
//                     this.isDraggingFile = false
//                 }
//                 */
//             },

//             onDropExplorer(ev){
//                 if(!this.isAssets(this.path)) return
//                 if(this.isDraggingUiEl) return
//                 if(this.isDraggingFile){
//                     /* file uploade logic */
//                     this.uploadFile(ev.dataTransfer.files)
//                     this.isDraggingFile = false
//                 }
//             },

//             /* file upload */
//             uploadFile(files) {
//               $perAdminApp.stateAction('uploadFiles', {
//                 path: $perAdminApp.getView().state.tools.assets,
//                 files: files,
//                 cb: this.setUploadProgress
//               })
//             },

//             setUploadProgress(percentCompleted){
//               this.uploadProgress = percentCompleted
//             },

//             onDoneFileUpload(){
//                 this.isFileUploadVisible = false
//                 this.uploadProgress = 0
//             },


//             isSelected: function(child) {
//                 if(this.model.selectionFrom && child) {
//                     return $perAdminApp.getNodeFromViewOrNull(this.model.selectionFrom) === child.path
//                 } else if(child.path === $perAdminApp.getNodeFromViewOrNull('/state/tools/page')) {
//                     return true
//                 }
//                 return false

//             },
//             hasChildren: function(child) {
//                 return child && child.childCount && child.childCount > 0;
//             },
//             editable: function(child) {
//                 return ['per:Page', 'per:Object'].indexOf(child.resourceType) >= 0
//             },
//             composumEditable: function(child) {
//                 return ['nt:file'].indexOf(child.resourceType) >= 0
//             },
//             viewable: function(child) {
//                 return ['per:Page', 'per:Object', 'nt:file'].indexOf(child.resourceType) >= 0
//             },
//             viewUrl: function(child) {
//                 var path = child.path
//                 var segments = path.split('/')
//                 var last = segments.pop()
//                 if(last.indexOf('.') >= 0) {
//                     return path
//                 }
//                 if(child.resourceType === 'per:Page') {
//                     return path + '.html'
//                 }
//                 return path + '.json'
//             },
//             nodeTypeToIcon: function(nodeType) {

//                 if(nodeType === 'per:Page')     return 'description'
//                 if(nodeType === 'per:Object')   return 'layers'
//                 if(nodeType === 'nt:file')      return 'insert_drive_file'
//                 if(nodeType === 'per:Asset')      return 'image'
//                 if(nodeType === 'sling:Folder') return 'folder'
//                 if(nodeType === 'sling:OrderedFolder') return 'folder'
//                 return 'unknown'
//             },
//             checkIfAllowed: function(resourceType) {
//                 return ['per:Asset', 'nt:file', 'sling:Folder', 'sling:OrderedFolder', 'per:Page', 'sling:OrderedFolder', 'per:Object'].indexOf(resourceType) >= 0
//             },
//             showInfo: function(me, target) {
//                 if(target.startsWith('/content/objects')) {
//                     const node = $perAdminApp.findNodeFromPath($perAdminApp.getView().admin.nodes, target)
//                     $perAdminApp.stateAction('selectObject', { selected: node.path, path: me.model.dataFrom })
//                 } else {
//                     $perAdminApp.stateAction('showPageInfo', { selected: target })
//                 }
//             },
//             selectPath: function(me, target) {
//                 let resourceType = target.resourceType
//                 if(resourceType) {
// //                    if(resourceType === 'per:Object') {
// //                        me.selectedObject = target.path
// //                        $perAdminApp.stateAction('selectObject', { selected: target.path, path: me.model.dataFrom })
// //                        return
// //                    }
//                     if(resourceType === 'per:Asset') {
//                         $perAdminApp.stateAction('selectAsset', { selected: target.path })
//                         return
//                     } else if(resourceType === 'nt:file') {
//                         return
//                     }
//                 }
//                 if($perAdminApp.getNodeFromView('/state/tools/object/show')) {
//                     $perAdminApp.stateAction('unselectObject', { })
//                 }
//                 if($perAdminApp.getNodeFromView('/state/tools/asset/show')) {
//                     $perAdminApp.stateAction('unselectAsset', { })
//                 }
//                 const payload = { selected: target.path, path: me.model.dataFrom }
//                 $perAdminApp.stateAction('selectToolsNodesPath', payload).then( () => {
//                     $('div.brand-logo span').last().click() //TODO: quick and dirty solution!!!!
//                 })
//             }
//             selectPathInNav: function(me, target) {
//                 this.selectPath(me, target)
//             },
//             viewPage: function(me, target) {
//                 alert(target)
//             },
//             addSite: function(me, target) {
//                 $perAdminApp.stateAction('createSiteWizard', '/content')
//             },
//             addPage: function(me, target) {
//                 if(me.pt.path === '/content/sites') {
//                     $perAdminApp.stateAction('createSiteWizard', me.pt.path)
// //                    $perAdminApp.notifyUser('create new site', 'to create a new site root, please visit the documentation on how to start a new site', null)
//                 } else {
//                     $perAdminApp.stateAction('createPageWizard', me.pt.path)
//                 }
//             },
//             addFolder: function(me, target) {
//                 if(me.pt.path.startsWith('/content/assets')) {
//                     $perAdminApp.stateAction('createAssetFolderWizard', me.pt.path)
//                 } else if(me.pt.path.startsWith('/content/objects')) {
//                     $perAdminApp.stateAction('createObjectFolderWizard', me.pt.path)
//                 }
//             },
//             sourceImage: function(me, target) {
//                 $perAdminApp.stateAction('sourceImageWizard', me.pt.path )
//             },
//             addTemplate: function(me, target) {
//                 const tenant = $perAdminApp.getView().state.tenant
//                 if(me.pt.path === tenant.roots.templates) {
//                     $perAdminApp.notifyUser('create new site', 'to create a new site root, please visit the documentation on how to start a new site', null)
//                 } else {
//                     $perAdminApp.stateAction('createTemplateWizard', me.pt.path)
//                 }
//             },
//             addObject: function(me, target) {
//                 $perAdminApp.stateAction('createObjectWizard', { path: me.pt.path, target: target })
//             },
//             deleteSiteOrPage: function(me, target) {
//                 if(me.path == '/content/sites') {
//                     me.deleteSite(me, target)
//                 }
//                 else {
//                     me.deletePage(me, target)
//                 }
//             },
//             deletePage: function(me, target) {
//                 $perAdminApp.askUser('Delete Page', me.$i18n('Are you sure you want to delete this node and all its children?'), {
//                     yes() {
//                         const resourceType = target.resourceType
//                         if(resourceType === 'per:Object') {
//                             $perAdminApp.stateAction('deleteObject', target.path)
//                         } else if(resourceType === 'per:Asset') {
//                                 $perAdminApp.stateAction('deleteAsset', target.path)
//                         } else if(resourceType === 'sling:OrderedFolder') {
//                             $perAdminApp.stateAction('deleteFolder', target.path)
//                         } else if(resourceType === 'per:Page') {
//                             $perAdminApp.stateAction('deletePage', target.path)
//                         } else if(resourceType === 'nt:file') {
//                             $perAdminApp.stateAction('deleteFile', target.path)
//                         }else {
//                             $perAdminApp.stateAction('deleteFolder', target.path)
//                         }
//                     }
//                 })
//             },
//             deleteSite: function(me, target) {
//                 $perAdminApp.askUser('Delete Site', me.$i18n('Are you sure you want to delete this site, its children, and generated content and components?'), {
//                     yes() {
//                         $perAdminApp.stateAction('deleteSite', target)
//                     }
//                 })
//             },
//             editPage: function(me, target) {
//                 const path = me.pt.path
//                 if(path.startsWith('/content/templates')) {
//                     $perAdminApp.stateAction('editTemplate', target )
//                 } else if(path.startsWith('/content/objects')) {
//                     const node = $perAdminApp.findNodeFromPath($perAdminApp.getView().admin.nodes, target)
//                     me.selectedObject = path
//                     $perAdminApp.stateAction('editObject', { selected: node.path, path: me.model.dataFrom })
//                 } else {
//                     $perAdminApp.stateAction('editPage', target )
//                 }
//             },
//             editFile: function(me, target) {
//                 window.open(`/bin/cpm/edit/code.html${target}`, 'composum')
//             }

        }

    }
</script>

<style>
    .item-activated {
        color: green;
    }

    .item-replication-unknown {
    }

    .item-deactivated {
        color: red;
    }

    .item-activated-modified {
        color: purple;
    }

</style>
